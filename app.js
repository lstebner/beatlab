(function(){var t,e,r,o,n,s,i=function(t,e){function r(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;e={},n=require("underscore"),s=require("underscore.string"),r={express:require("express"),http:require("http"),path:require("path"),mongoose:require("mongoose"),fs:require("fs")},r.Schema=r.mongoose.Schema,t=function(){function t(t){null==t&&(t={}),this.env=process.env.NODE_ENV,this.site_name=t.site_name,this.config=t.config,this.app=t.app,this.mongoose=t.mongoose,this.config=n.extend(e,this.config||{}),this.load_environment_config(),this.setup()}var e,o,s,i;return i=r.fs,s=r.express,e={title:"",base_url:"",meta_keywords:"",meta_description:"",css_version:1,js_version:1,port:3e3,debug:!1},o=__dirname.replace(/spec(\/|)/,""),t.set_site=function(t){this.site=t},t.init=function(e,r){return null==e&&(e={}),null==r&&(r=t),r===t?this.site=new t(e):this.site=r.init(e)},t.slugify=function(t,e){var r,o;return r="-",o=t.toString().replace(/[\s\.]+/g,r).toLowerCase().replace(new RegExp("[^a-z0-9"+r+"]","g"),r).replace(new RegExp(r+"+","g"),r),o.charAt(o.length-1)===r&&(o=o.substring(0,o.length-1)),o.charAt(0)===r&&(o=o.substring(1)),null!=e?o+"-"+e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear():o},t.pretty_date=function(t){return moment(t).fromNow()},t.base_url=function(t,e){var r;return null==e&&(e=!1),null!=(r=this.site)?r.base_url(t,e):void 0},t.conf=function(t){var e;return null!=(e=this.site)?e.conf(t):void 0},t.get_conf=function(){var t;return null!=(t=this.site)?t.config:void 0},t.prototype.load_environment_config=function(){var t,e,r,s;s=o+"/app/conf/"+this.env+".conf",t=i.readFileSync(s,"UTF-8");try{if(r=JSON.parse(t),this.config=n.extend(this.config,r),this.config.debug)return console.log(this.env+" config loaded")}catch(u){if(e=u,this.config.debug)return console.log("error! parsing json in "+this.env+" conf")}},t.prototype.before_ready=function(){return 1},t.prototype.setup=function(){var e,o;for(e in r)o=r[e],this[e]=o;return this.configure_app(),this.router=new t.Router(this.app),this.setup_mongoose(),this.setup_routes(),this.listener=this.app.listen(this.config.port),this.listener?this.config.debug&&console.log("Express server listening on port %d in %s mode",this.listener.address().port,this.app.settings.env):this.config.debug&&console.log("listener did not start"),this.before_ready(),this.is_setup=!0,this.ready()},t.prototype.ready=function(){return 1},t.prototype.setup_mongoose=function(){return this.mongoose.connect("mongodb://"+this.conf("db_host")+"/"+this.conf("db_name"))},t.prototype.conf=function(t){var e;return null!=t&&(null!=(e=this.config)?e.hasOwnProperty(t):void 0)?this.config[t]:!1},t.prototype.base_url=function(t,e){var r;return null==t&&(t="/"),null==e&&(e=!1),"development"!==process.env.NODE_ENV||e?r=""+this.conf("base_url")+t:t},t.prototype.route=function(e,r,o){var n,s,i,u,p,a;if(null==o&&(o="get"),i="index",p="#",u=r.split(p),s=u[0].substr(0,1).toUpperCase()+u[0].substring(1),n=t[s+"Controller"],null==n)return this.config.debug?console.log("App route error, controller not found: "+s):!1;switch(a=null!=u[1]?u[1]:i,o){case"get":return this.router.get(e,n,a);case"post":return this.router.post(e,n,a)}},t.prototype.setup_routes=function(){return this.route("/sitemap","sitemap"),this.route("/post/:slug","post#index"),this.route("/category/:category","listing#by_category"),this.route("/tag/:tag","listing#by_tag"),this.route("/blog","listing#latest"),this.route("/store","store"),this.route("/about-me","home#about"),this.route("/","home")},t.prototype.configure_app=function(){return s=s,this.app.configure(function(t){return function(){return t.always_configure()}}(this)),this.app.configure("development",function(t){return function(){return t.app.use(s.errorHandler({dumpExceptions:!0,showStack:!0})),t.configure_for_development()}}(this)),this.app.configure("production",function(t){return function(){return t.app.use(s.errorHandler()),t.configure_for_production()}}(this)),this.is_configured=!0},t.prototype.always_configure=function(){return this.app.set("views",o+"/views"),this.app.set("view engine","jade"),this.app.use(s.bodyParser()),this.app.use(s.methodOverride()),this.app.use(this.app.router),this.app.use(s["static"](o+"/public"))},t.prototype.configure_for_development=function(){return 1},t.prototype.configure_for_production=function(){return 1},t}(),t.Schemas={},o=r.Schema,t.Schemas.Project=new o({title:{type:String,required:!0},order:{type:Number,"default":0},slug:{type:String,require:!0,unique:!0},description:{type:String,"default":""},display_url:{type:String,"default":""},full_url:{type:String,defalut:""},technologies:{type:o.Types.Mixed,"default":[]},images:{type:o.Types.Mixed,"default":[]},archived:{type:Boolean,"default":!1},group:{type:String,"default":"default"}}),t.Models={Project:r.mongoose.model("Project",t.Schemas.Project)},t.Router=function(){function t(t,e){if(this.app=t,this.opts=null!=e?e:{},!this.app)throw new Error("an app is required to create a Router");this.routes=[]}return t.debug=!1,t.prototype.register=function(e,r,o,n){var s;return t.debug&&console.log("router: add_route "+e.toUpperCase()+" "+r+", "+o.name+"#"+n),s=[e,r,o,n],this.routes.push(s),this.app[e](r,function(t){return function(e,r){var s;return s=new o(e,r),s["do"](n)?void 0:(console.error("method '"+n+"' not found for controller "+o),t.do_404(r))}}(this)),s},t.prototype.do_404=function(t){return t.status(404).send("Sorry, page not found!")},t.prototype.get=function(t,e,r){return this.register("get",t,e,r)},t.prototype.post=function(t,e,r){return this.register("post",t,e,r)},t.prototype.add_routes=function(t){var e,r,o,s,i;o=t.routes,s=[];for(r in o)i=o[r],e={type:"get",path:r,controller:t,method:null},n.isObject(i)?e=n.extend(e,i):e.method=i,s.push(this.register(e.type,e.path,e.controller,e.method));return s},t}(),t.View=function(){function e(t,e,r,o){this.data=null!=t?t:{},this.req=e,this.res=r,this.app=o,this.js_opts={},this.default_data(),this.set_view(this.data.view)}return e.prototype.default_data=function(){return this.data=n.extend({layout:!0,title:t.conf("site_name"),site_name:t.conf("site_name"),meta:{keywords:t.conf("site_keywords"),description:t.conf("site_description")},this_url:this.req.url,_:n,view:"index",disqus_shortname:t.conf("disqus_shortname"),cookies:null,body_class:"",single_upload_view:!1,this_url:this.req.url,pagination_data:{},uploads_filter:{},load_more:!0,display_comments:!1,no_uploads_message:!1,css_version:t.conf("css_version"),js_version:t.conf("js_version"),base_url:t.base_url(),auto_generated_id:this.auto_generate_id(),js_opts:this.js_opts,compiled_js:!1},this.data),this.data},e.prototype.auto_generate_id=function(){return"auto_id_"+(new Date).getTime().toString(36)},e.prototype.add_js_opts=function(t){return null==t&&(t={}),this.js_opts=n.extend(this.js_opts,t)},e.prototype.set_view=function(t){this.view=t},e.prototype.set_data=function(t,e){return this.data[t]=e},e.prototype.extend_data=function(t){return null==t&&(t={}),this.data=n.extend(this.data,t)},e.prototype.js_block=function(){return!1},e.prototype.render=function(){return this.data.js_opts&&this.add_js_opts(this.data.js_opts),this.data.compiled_js=this.js_block(),this.res.render(this.view,n.extend(t.get_conf(),this.data,{js_opts:JSON.stringify(this.js_opts)}))},e}(),t.Controller=function(){function e(t,e){this.req=t,this.res=e,this.requirements_list={},this.loaded_items=[],this.current_needs=[],this.public_methods=[],this.view_data={},this.view_to_render="",this.setup()}return e.prototype.name="base",e.prototype.view_class=t.View,e.prototype.setup=function(){return this.setup_preload()},e.prototype.setup_preload=function(){return 1},e.prototype.requires=function(t,e){var r,o,s,i,u,p,a,h,c,l;if(null==e&&(e="all"),n.isArray(t)||(t=[t]),r=function(t){return function(e,r){return t.requirements_list[e]=null!=t.requirements_list[e]?n.union(t.requirements_list[e],r):r}}(this),n.isObject(e)){for(a=null!=e.except?n.difference(this.public_methods,e.except):null!=e.only?n.intersection(this.public_methods,e.only):void 0,c=[],o=0,i=a.length;i>o;o++)p=a[o],c.push(r(p,t));return c}if("all"===e){for(h=this.public_methods,l=[],s=0,u=h.length;u>s;s++)p=h[s],l.push(r(p,t));return l}return r(e,t)},e.prototype.preload=function(t){return null==this.requirements_list[t]?!0:(this.current_needs=this.requirements_list[t],this.load(this.current_needs.join(" ")))},e.prototype["do"]=function(t,e){return this.requested_method=t,this.prevent_render=null!=e?e:!0,this.preload(this.requested_method),this.has_needs_met()?null!=this[this.requested_method]&&n.indexOf(this.public_methods,this.requested_method)>-1?(this[this.requested_method](),this.prevent_render||this.render()):(console.log("method not found or not public",this.name+"::"+this.requested_method),this.do_404()):setTimeout(function(t){return function(){return t["do"](t.requested_method,t.prevent_render)}}(this),50),!0},e.prototype.do_404=function(){return this.res.status(404),this.res.render("404",{title:" 404, man"})},e.prototype.param=function(t){return this.req.params.hasOwnProperty(t)?this.req.params[t]:!1},e.prototype.query=function(t){return this.req.query.hasOwnProperty(t)?this.req.query[t]:!1},e.prototype.cookie=function(t){return this.req.cookies&&this.req.cookies.hasOwnProperty(t)?this.req.cookies[t]:!1},e.prototype.body=function(t){return this.req.body&&this.req.body.hasOwnProperty(t)?this.req.body[t]:!1},e.prototype.redirect=function(t,e){return null==e&&(e=302),this.res.redirect(e,t)},e.prototype.load=function(t){var e,r,o,n;if(this.loaded_items){for(n=this.loaded_items,r=0,o=n.length;o>r;r++)e=n[r],t=t.replace(""+e,"");t=s.trim(t.replace(/\s\s/g,""))}else this.loaded_items=[];return t.length?!0:!1},e.prototype.loaded=function(t){return this.loaded_items||(this.loaded_items=[]),this.loaded_items.push(t)},e.prototype.has_needs_met=function(){var t,e,r,o,s;if(n.isEmpty(this.current_needs))return!0;for(t=!0,s=this.current_needs,e=0,r=s.length;r>e;e++)o=s[e],t=t&&n.indexOf(this.loaded_items,o)>-1;return t},e.prototype.json=function(t){return this.res.json(t)},e.prototype.render=function(t,e){return null==t&&(t=null),null==e&&(e=this.view_data),this.view_class?(this.before_render(),this.cancel_render?this.cancel_render=!1:(this.view_data.view=n.isEmpty(t)?n.isEmpty(this.view_to_render)?this.requested_method:this.view_to_render:t,this.current_view=new this.view_class(this.view_data,this.req,this.res,this.app),this.current_view.render(),this.after_render(),this.cancel_render=!1,this.current_view)):!1},e.prototype.set_view=function(t){return this.view_to_render=t,1},e.prototype.before_render=function(){return 1},e.prototype.after_render=function(){return 1},e}(),e.App=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}var s,u,p;return i(o,t),s=r.express,p=r.mongoose,u=r.fs,o.init=function(t){return null==t&&(t={}),this.site=new e.App(n.extend({app:s(),mongoose:p,config:{port:3054,title:"Kids on the beat, beat kids | BeatLab",base_url:"http://beatlab.io",meta_keywords:"",meta_description:"",css_version:(new Date).getTime(),js_version:(new Date).getTime()},opts:t}))},o.prototype.ready=function(){},o.prototype.setup_routes=function(){return this.route("/","home#index"),this.route("/sitemap","sitemap#index")},o.prototype.always_configure=function(){var t;return s=s,t=315576e5,this.app.set("port",process.env.PORT||this.conf("port")),this.app.set("views",__dirname+"/views"),this.app.set("view engine","jade"),this.app.use(s.logger("dev")),this.app.use(s.cookieParser()),this.app.use(s.bodyParser()),this.app.use(s.session({secret:"whateverb34tlabb3r"})),this.app.use(s.methodOverride()),this.app.use(s["static"](__dirname+"/public",{maxAge:t})),this.app.use(this.app.router)},o.prototype.configure_for_development=function(){return this.app.use(s.errorHandler()),this.app.locals.pretty=!0},o.prototype.configure_for_production=function(){},o.prototype.before_ready=function(){},o}(t),e.Query=function(){function t(){}return t}(),e.Controller=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e}(t.Controller),e.HomeView=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.js_block=function(){return'World.Home.init("#'+this.data.auto_generated_id+'", '+JSON.stringify(this.data.js_opts)+");"},e}(t.View),t.SitemapController=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,e),r.prototype.name="SitemapController",r.prototype.setup=function(){return this.public_methods=["index"],this.requires("sitemap_urls"),r.__super__.setup.apply(this,arguments)},r.prototype.load=function(){var e,r,o,n;for(n=["/"],this.sitemap_urls=[],e=0,r=n.length;r>e;e++)o=n[e],this.sitemap_urls.push(t.base_url(o,!0));return this.loaded("sitemap_urls")},r.prototype.index=function(){this.res.header("Content-type","text/plain"),this.res.end(n.uniq(this.sitemap_urls).join("\n"))},r}(t.Controller),t.HomeController=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}var o;return i(r,t),o=e.Query,r.prototype.name="HomeController",r.prototype.view_class=e.HomeView,r.prototype.setup=function(){return this.public_methods=["index"],r.__super__.setup.apply(this,arguments)},r.prototype.load=function(t){!r.__super__.load.apply(this,arguments)},r.prototype.index=function(){return this.render("index")},r}(e.Controller),t.init({},e.App)}).call(this);